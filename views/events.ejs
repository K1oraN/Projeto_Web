<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Check-in</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/eventos.css">
</head>
<body>
    <header>
        <h1>Tela de eventos</h1>
        <div class="icone_perfil">
            <button><img src="/img/login-cadastro/user.png" alt="Ícone do usuário"></button>
        </div>
    </header>

    <main>
        <section id="eventos">
          <%
          const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleString('pt-BR', {
              day: '2-digit',
              month: '2-digit',
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
        };

          const formatCEP = (cep) => {
          return cep.replace(/(\d{5})(\d{3})/, '$1-$2');
        };
          %>

          <% if (eventos.novos && eventos.novos.length > 0) { %>
            <div>
              <h2>Novos Eventos</h2>
              <div class="events-container">
                <% eventos.novos.forEach(event => { %>
                  <div class="event-card novo">
                    <h3><%= event.name %></h3>
                    <p class="date"><%= formatDate(event.eventDate) %></p>
                    <p>R$ <%= event.ticketPrice.toFixed(2).replace('.', ',') %></p>
                    <button onclick="mostrarModal(this)"
                      data-name="<%= event.name %>"
                      data-date="<%= formatDate(event.eventDate) %>"
                      data-deadline="<%= formatDate(event.ticketDeadline) %>"
                      data-description="<%= event.description %>"
                      data-location="<%= event.street %>, <%= event.number %> - <%= event.neighborhood %>, <%= event.city %> - <%= event.state %>, CEP: <%= formatCEP(event.cep) %>"
                      data-price="<%= event.ticketPrice.toFixed(2).replace('.', ',') %>"
                      data-max-tickets="<%= event.maxTickets %>"
                      class="btn btn-primary">
                      Mais informações
                  </button>
                  </div>
                <% }); %>
              </div>
            </div>
          <% } %>

          <% if (eventos.disponiveis && eventos.disponiveis.length > 0) { %>
            <div>
              <h2>Inscrições abertas</h2>
              <div class="events-container">
                <% eventos.disponiveis.forEach(event => { %>
                  <div class="event-card disponivel">
                    <h3><%= event.name %></h3>
                    <p class="date"><%= formatDate(event.eventDate) %></p>
                    <button onclick="mostrarModal(this)"
                      data-name="<%= event.name %>"
                      data-date="<%= formatDate(event.eventDate) %>"
                      data-deadline="<%= formatDate(event.ticketDeadline) %>"
                      data-description="<%= event.description %>"
                      data-location="<%= event.street %>, <%= event.number %> - <%= event.neighborhood %>, <%= event.city %> - <%= event.state %>, CEP: <%= formatCEP(event.cep) %>"
                      data-price="<%= event.ticketPrice.toFixed(2).replace('.', ',') %>"
                      data-max-tickets="<%= event.maxTickets %>"
                      class="btn btn-primary">
                      Mais informações
                    </button>
                <% }); %>
              </div>
            </div>
          <% } %>

          <% if (eventos.encerrados && eventos.encerrados.length > 0) { %>
            <div>
              <h2>Eventos encerrados</h2>
              <div class="events-container">
                <% eventos.encerrados.forEach(event => { %>
                  <div class="event-card encerrado">
                    <h3><%= event.name %></h3>
                    <p class="date"><%= formatDate(event.eventDate) %></p>
                    <p>R$ <%= event.ticketPrice.toFixed(2).replace('.', ',') %></p>
                    <button>Encerrado</button>
                  </div>
                <% }); %>
              </div>
            </div>
          <% } %>
        </section>
      </main>

      <footer>
        <p>&copy; 2025 Entrada Express. Todos os direitos reservados.</p>
      </footer>

      <!-- Modal -->
      <div class="modal-overlay" id="modalOverlay"></div>
      <div class="modal" id="modal">
          <div class="modal-content">
              <div class="modal-header">
                  <h2 id="eventName"></h2>
                  <button class="close-modal" onclick="fecharModal()">&times;</button>
              </div>
              
              <div class="modal-body">
                  <div class="event-info">
                      <div class="info-item">
                          <strong>Data do Evento:</strong>
                          <span id="eventDate"></span>
                      </div>

                      <div class="info-item">
                          <strong>Inscrições até:</strong>
                          <span id="ticketDeadline"></span>
                      </div>

                      <div class="info-item">
                          <strong>Descrição:</strong>
                          <p id="eventDescription"></p>
                      </div>

                      <div class="info-item">
                          <strong>Local:</strong>
                          <span id="eventLocation"></span>
                      </div>

                      <div class="info-item">
                          <strong>Valor:</strong>
                          <span id="eventPrice"></span>
                      </div>

                      <div class="info-item">
                          <strong>Ingressos Disponíveis:</strong>
                          <span id="availableTickets"></span>
                      </div>
                  </div>
              </div>

              <div class="modal-footer">
                  <button class="btn btn-secondary" onclick="fecharModal()">Fechar</button>
                  <button class="btn btn-primary" id="buyButton" onclick="comprarIngresso()">
                    Comprar Ingresso
                  </button>
              </div>
          </div>
      </div>
      <script src="/js/eventos.js"></script>
    </body>
    </html>